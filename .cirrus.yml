freebsd_instance:
  image: freebsd-11-2-release-amd64

task:
  name: FreeBSD local deploy
  pip_cache:
    folder: ~/.cache/pip
    fingerprint_script: cat requirements.txt
    populate_script: &populate_script
      - pkg install -y python3 bash py36-pip py36-virtualenv base64
      - python3 -m pip install -U pip virtualenv
      - python3 -m pip install -r requirements.txt
  env:
    ALGO_SERVER: localhost
    ALGO_ENDPOINT: 127.0.0.1
  install_script: *populate_script
  script:
    - ./tests/local-deploy.sh -e ansible_python_interpreter=/usr/local/bin/python3 --skip-tags ipfw
    - ./tests/update-users.sh -e ansible_python_interpreter=/usr/local/bin/python3
  check_script:
    - /usr/local/sbin/ipsec status
    - /usr/local/bin/wg | grep ^interface
    - /usr/bin/host google.com 172.16.0.1
